<!DOCTYPE html>
<meta charset="utf-8">
  <head>
    <title>Tag Engine for Data Catalog</title>
    <link rel="stylesheet" type="text/css" href="/static/style.css">
  </head>  
    <body>
	   <div class="pagetitle">
	   <h1>Create Config</h1>
        </div>
	  <h5>
	  <span style="color:red;">
	  Note: This config needs to be attached to the <a href="https://github.com/GoogleCloudPlatform/datacatalog-templates/blob/master/data_sensitivity.yaml">data sensitivity</a> tag template. You can add new fields to this template prior to creating the config, but you cannot remove the <i>sensitive_field</i> or <i>sensitive_type</i> fields from the template as those are required. Please be sure to also create the matching policy tag taxonomy prior to running the config. Consult the documentation for more details. 
	   </span>
	   </h5>
	   </div>
	   <h3>Tag Template Fields</h3>
	   <h5 style="width: 700px;">To include a field in the tag, click on the checkbox next to the field. The tag will be created with the selected fields. <br><br>
	   
	   Mandatory template fields are marked by <span style="color:red;">*</span>. 
	   </h5>
         <form method="post" action="/process_sensitive_column_config">
		    <table>
			   {% for dict_field in fields %}
		        <tr>
		          <td>
				{% if dict_field['is_required'] == True %}
                    <input type="checkbox" class="form-control move-left" name="selected" value="{{ dict_field['field_id'] }}" checked>
				{% else: %}
                    <input type="checkbox" class="form-control move-left" name="selected" value="{{ dict_field['field_id'] }}">
				{% endif %}
				</td>
				<td>
				{% if dict_field['is_required'] == True %}
				<span style="color:red;">*</span>
				{% else: %}
				&nbsp;
				{% endif %}
				{{ dict_field['field_id'] }}
				</td>
			   </tr>
			   {% endfor %}
			   </table>
		    <p>&nbsp;</p>
		   
 		   <h3>DLP Dataset</h3>
 	   
 		   <h5>
 		   Specify the path to your DLP findings dataset in BigQuery. This is the location of the dataset that contains the inspection findings generated by DLP. <br><br>
 				  Supported URI format: <br>
 				  &nbsp;&nbsp;bigquery/project/[PROJECT]/dataset/[DATASET] <br>
 			        </h5>
 			    <table>
 			     <tr>
 			    <td><span style="color:red;">*</span> DLP Dataset URI:&nbsp;&nbsp;
 			    	  <input type="text" value="bigquery/project/[PROJECT]/dataset/[DATASET]" name="dlp_dataset" style="align-content:left; width: 700px; overflow:auto;"/>

 			    	</td>
 			     </tr>
 			 </table>
 				 <p>&nbsp;</p>
		   
		   <h3>Infotype Tables</h3>
	 	   
		   <h5>
		   Specify the paths to your infotype selection and classification tables in BigQuery. View sample tables <a href="https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/blob/develop/examples/sensitive_column_configs/dlp/create_classification_tables.sql">here</a>. <br><br>
				  Supported URI format: <br>
				  &nbsp;&nbsp;bigquery/project/[PROJECT]/dataset/[DATASET]/[TABLE] <br>
			        </h5>
			    <table>
			     <tr>
			    <td><span style="color:red;">*</span> Infotype Selection Table:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			    	  <input type="text" value="bigquery/project/[PROJECT]/dataset/[DATASET]/[TABLE]" name="infotype_selection_table" style="align-content:left; width: 700px; overflow:auto;"/>
			     </td>
			     </tr>
				 <tr><td>&nbsp;</td></tr>
 			     <tr>
 			    <td><span style="color:red;">*</span> Infotype Classification Table:&nbsp;&nbsp;
 			    	  <input type="text" value="bigquery/project/[PROJECT]/dataset/[DATASET]/[TABLE]" name="infotype_classification_table" style="align-content:left; width: 700px; overflow:auto;"/>
 			     </td>
 			     </tr>
			 </table>
				 <p>&nbsp;</p>
			   <h3>BigQuery Tables</h3>
		 	   
	 		   <h5>Specify one or more URIs to include in or exclude from your dynamic config. Wildcards are allowed in the table name. <br><br>
				  Supported URI syntax: <br>
				  &nbsp;&nbsp;bigquery/project/[PROJECT]/* <br>
				  &nbsp;&nbsp;bigquery/project/[PROJECT]/dataset/[DATASET]/* <br>
			      &nbsp;&nbsp;bigquery/project/[PROJECT]/dataset/[DATASET]/[TABLE] <br>
			  </h5>
				    <table>
				     <tr>
				    <td><span style="color:red;">*</span> Included Tables URIs:&nbsp;&nbsp;
				    	  <input type="text" name="included_tables_uris" value="bigquery/project/[PROJECT]/dataset/[DATASET]/*" style="align-content:left; width: 700px; overflow:auto;"/>

				    	</td>
				     </tr>
				     <tr><td>&nbsp;</td></tr>
	 				<tr>
	 			    <td>&nbsp;&nbsp;Excluded Tables URIs:&nbsp;
				    	  <input type="text" name="excluded_tables_uris" style="align-content:left; width: 700px; overflow:auto;"/>			 
				    </td>
	 		         </tr>
			    </table>
				<p>&nbsp;</p>
				
				
				<h3>Policy Tag Details</h3>
	 	   
						  <h5>
						   Tag Engine can apply a policy tag on each sensitive column. This option requires a policy tag taxonomy with a policy tag name that matches each sensitive category. <br><br>
						   
						  Supported format for the Policy Tag Taxonomy ID: <br>
						  &nbsp;&nbsp;projects/[PROJECT]/locations/[REGION]/taxonomies/[TAXONOMY_ID] <br><br>
						   
						   	If you don't want Tag Engine to create any policies tags, set the Create Policy Tags flag to FALSE. <br><br>
								  
							 </h5>
							    <table>
									   <tr><td><span style="color:red;">*</span>&nbsp;Create Policy Tags:</td>
										   <td>&nbsp;<select name="policy_tags" style="width: 80px;">`
												   	<option value="true">TRUE</option>
													<option value="false" selected>FALSE</option>
												   </select>
									    	  </td>
								    </tr>
							     </table>
								<br>
								<table>
								 <tr>
								
							    <td>&nbsp;&nbsp;Policy Tag Taxonomy ID:&nbsp;&nbsp;
							    	  <input type="text" value="projects/[PROJECT]/locations/[REGION]/taxonomies/[TAXONOMY_ID]" name="taxonomy_id" style="align-content:left; width: 700px; overflow:auto;"/>

							    	</td>
							     </tr>
							 </table>
								 
				
	 		   
 		        <p>&nbsp;</p>
 			   <h3>Scheduling Options</h3>
 		 	  
 		 		   <h5>If you choose the AUTO refresh mode, your entry config will be scheduled for updates based on your specified refresh frequency. <br>
 					   If you choose the ON-DEMAND refresh mode, your entry config will <b>not</b> be scheduled for updates (even if you specify a refresh frequency). <br>The AUTO mode is helpful for registering and tagging new files on GCS on a recurring schedule. It will not re-register or re-tag existing files. <br><br>
 				   </h5>
 				
 			     <table>
 				<tr>	
 			    <td><span style="color:red;">*</span> Refresh mode:&nbsp;<select name="refresh_mode" style="width: 100px;padding: 3px;">
   				  				<option value="AUTO" selected>AUTO</option>
   							   	<option value="ON-DEMAND">ON-DEMAND</option>
 							  </select>
 			    </td>
 		         </tr>
 			     <tr><td>&nbsp;</td></tr>
 				<tr>	
 			    <td>Refresh frequency:&nbsp;<input type="text" value="24" name="refresh_frequency" style="width: 30px;padding: 3px;">&nbsp;
 				    			  <select name="refresh_unit" style="width: 70px;padding: 3px;">
								<option value="minutes">minutes</option>
   				  				<option value="hours" selected>hours</option>
   							   	<option value="days">days</option>
 							  </select></td>
 		         </tr>
 		        </table>
			    
				<p>&nbsp;</p>
			    <h3>Tag History Option:</h3>
				
			    <table>
			    <tr><td>&nbsp;&nbsp;
				{% if tag_history_option %}
					ON
				{% else %}
					OFF
				{% endif %}
			    </td></tr>
			    </table>
				
				
				<p>&nbsp;</p>
		        <table>
		        <tr>
			   <td><input type="submit" value="Create Config" name="action">
			       <input type="submit" value="Cancel Changes" name="action">
			   </td>
		        </tr>
			   </table>
			   <input type="hidden" name="template_id" value="{{ template_id }}">
			   <input type="hidden" name="template_project" value="{{ template_project }}">
			   <input type="hidden" name="template_region" value="{{ template_region }}">
			   <input type="hidden" name="service_account" value="{{ service_account }}">
			   
			   {% for dict_field in fields %}
			   	<input type="hidden" name="{{ dict_field['field_id'] }}_datatype" value="{{ dict_field['field_type'] }}">
			    {% endfor %}	   
         </form>
    </body>
</html>
