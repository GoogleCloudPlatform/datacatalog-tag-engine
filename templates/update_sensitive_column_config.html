<!DOCTYPE html>
<meta charset="utf-8">
  <head>
    <title>Tag Engine</title>
    <link rel="stylesheet" type="text/css" href="/static/style.css">
  </head>  
    <body>
	   <div class="pagetitle">
	   <h1>Update Config</h1>
        </div>
	   
 	  	<h5>Make changes to your sensitive column config below. Note that the template fields <i>sensitive_field</i> and <i>sensitive_type</i> must be selected as they are required for this config.</h5>
	   
 		<h5>Mandatory tag template fields are marked by <span style="color:red;">*</span>.</h5>
	   </div>
	   
  	  <table>
  		  <tr><td>&nbsp;<span style="color:#0b5394;">Config Id:</span> {{ config['config_uuid'] }}</td></tr> 
  		  <tr><td>&nbsp;<span style="color:#0b5394;">Config Status:</span> {{ config['config_status'] }}</td></tr> 
  		  <tr><td>&nbsp;<span style="color:#0b5394;">Config Type:</span> {{ config['config_type'] }}</td></tr>
  	  </table>
	  <br>
	   <h3>Tag Template Fields</h3>

         <form method="post" action="/process_sensitive_column_config">
		    <table>
			
		   {% for field in fields %}
	        <tr>
	          <td>   
			   {% set ns = namespace(found=false) %}
			   
			   {% for current_field in config['fields']  %}
			      {% if current_field['field_id'] == field['field_id'] %}
				      
					 {% set ns.found = true %}
                           
					 <input type="checkbox" class="form-control move-left" name="selected" value="{{ field['field_id'] }}" checked>
				 {% endif %}
			    {% endfor %}
			    
			    {% if ns.found == false %}
			       <input type="checkbox" class="form-control move-left" name="selected" value="{{ field['field_id'] }}">
			    {% endif %}
			    
			    
			</td>
			<td>
			{% if field['is_required'] == True %}
			<span style="color:red;">*</span>
			{% else: %}
			&nbsp;
			{% endif %}
			{{ field['field_id'] }} (type {{ field['field_type'] }}):
			</td>
		  </tr>
		  {% endfor %}	
			
			</table>
		    <p>&nbsp;</p>
			

	   <h3>DLP Dataset</h3>
   
	  <h5>
	   Specify the path to your DLP findings dataset in BigQuery. This is the location of the dataset that contains the inspection findings generated by DLP. <br><br>
			  Supported URI format: <br>
			  &nbsp;&nbsp;bigquery/project/[PROJECT]/dataset/[DATASET] <br>
		        </h5>

		    <table>
		     <tr>
		    <td><span style="color:red;">*</span> DLP Dataset URI:&nbsp;&nbsp;
		    	  <input type="text" value="{{ config['dlp_dataset'] }}" name="dlp_dataset" style="align-content:left; width: 700px; overflow:auto;"/>

		    	</td>
		     </tr>
		 </table>
			 <p>&nbsp;</p>
	   
	   <h3>Infotype Tables</h3>
 	   
	  <h5>
	   Specify the paths to your infotype selection and classification tables in BigQuery. View sample tables <a href="https://github.com/GoogleCloudPlatform/datacatalog-tag-engine/blob/develop/examples/sensitive_column_configs/dlp/create_classification_tables.sql">here</a>. <br><br>
			  Supported URI format: <br>
			    bigquery/project/[PROJECT]/dataset/[DATASET]/[TABLE] <br>
		        </h5>

		    <table>
		     <tr>
		    <td><span style="color:red;">*</span> Infotype Selection Table:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		    	<input type="text" value="{{ config['infotype_selection_table'] }}" name="infotype_selection_table" style="align-content:left; width: 700px; overflow:auto;"/>
		     </td>
		     </tr>
			 <tr><td>&nbsp;</td></tr>
 		     <tr>
 		    <td><span style="color:red;">*</span> Infotype Classification Table:&nbsp;&nbsp;
 		    	<input type="text" value="{{ config['infotype_classification_table'] }}" name="infotype_classification_table" style="align-content:left; width: 700px; overflow:auto;"/>
 		     </td>
 		     </tr>
		 </table>
			 <p>&nbsp;</p>
		   <h3>BigQuery Tables</h3>
	 	   
		   <h5>Specify URIs for resources to include in or exclude from your dynamic tag. Wildcards are allowed in the table name. <br><br>
		   Supported URIs: <br>
		   bigquery/project/[PROJECT]/* <br>
		   bigquery/project/[PROJECT]/dataset/[DATASET]/* <br>
	       bigquery/project/[PROJECT]/dataset/[DATASET]/[TABLE] </h5>
			    <table>
			     <tr>
			    <td><span style="color:red;">*</span> Included Tables URIs:&nbsp;&nbsp;
			    	  <input type="text" name="included_tables_uris" value="{{ config['included_tables_uris'] }}" style="align-content:left; width: 700px; overflow:auto;"/>

			    	</td>
			     </tr>
			     <tr><td>&nbsp;</td></tr>
 				<tr>
 			    <td>&nbsp;&nbsp;Excluded Tables URIs:&nbsp;
			    	  <input type="text" name="excluded_tables_uris" value="{{ config['excluded_tables_uris'] }}" style="align-content:left; width: 700px; overflow:auto;"/>			 
			    </td>
 		         </tr>
		    </table>
			<p>&nbsp;</p>
			
			
			<h3>Policy Tag Details</h3>
 	   
					  <h5>
					   Tag Engine can apply a policy tag on each sensitive column. This option requires a policy tag taxonomy with a policy tag name that matches each sensitive category. <br><br>
					   
					  Supported format for the Policy Tag Taxonomy ID: <br>
					  &nbsp;&nbsp;projects/[PROJECT]/locations/[REGION]/taxonomies/[TAXONOMY_ID] <br><br>
					   
					   	If you don't want Tag Engine to create any policies tags, set the Create Policy Tags flag to FALSE. <br><br>
							  
						 </h5>
						    <table>
								   <tr><td><span style="color:red;">*</span>&nbsp;Create Policy Tags:</td>
									   <td>&nbsp;<select name="policy_tags" style="width: 80px;">
										   {% if config['create_policy_tags'] == True %} 
											   	<option value="true" selected>TRUE</option>
												<option value="false">FALSE</option>
										   {% elif config['create_policy_tags'] == False %}
										   	    <option value="true">TRUE</option>
												<option value="false" selected>FALSE</option>
										   {% endif %}
										</select></td> 
							    </tr>
						     </table>
							<br>
							<table>
							 <tr>
							
						    <td>&nbsp;&nbsp;Policy Tag Taxonomy ID:&nbsp;&nbsp;
						    	  <input type="text" value="{{ config['taxonomy_id'] }}" name="taxonomy_id" style="align-content:left; width: 700px; overflow:auto;"/>

						    	</td>
						     </tr>
						 </table>
							 
			
 		   
	        <p>&nbsp;</p>
			
 		   
		   
		   			   <h3>Scheduling Options</h3>
		 
		 		   <h5>If you choose the AUTO refresh mode, your entry config will be scheduled for updates based on your specified refresh frequency.<br>
					   If you choose the ON-DEMAND refresh mode, your entry config will <b>not</b> be scheduled for updates (even if you specify a refresh frequency). <br>This mode is useful when no new files get added to your dataset on a regular basis or when you want to control the cataloging of new files through the Tag Engine API. <br><br>
				   </h5>
			
			     <table>
 				<tr>	
 			    <td><span style="color:red;">*</span>Refresh Mode:&nbsp;
					        <select name="refresh_mode" style="width: 100px;">
				    			{% if config['refresh_mode'] == 'AUTO' %}
   				  				<option value="AUTO" selected>AUTO</option>
   							   	<option value="ON-DEMAND">ON-DEMAND</option>
							{% else %}
   				  				<option value="AUTO">AUTO</option>
   							   	<option value="ON-DEMAND" selected>ON-DEMAND</option>
							{% endif %}
 							  </select>
							  
 			    </td>
 		         </tr>
 			     <tr><td>&nbsp;</td></tr>
				<tr>	
			    <td>Refresh Frequency: <input type="text" value="{{ config['refresh_frequency'] }}" name="refresh_frequency" style="width: 30px;padding: 3px;"> &nbsp;<select name="refresh_unit" style="width: 70px;padding: 3px;">
	  						{% if config['refresh_unit'] == 'minutes' %}
	     				  			<option value="minutes" selected>minutes</option>
									<option value="hours">hours</option>
	     							<option value="days">days</option>
  				    		{% elif config['refresh_unit'] == 'hours' %}
     				  				<option value="minutes">minutes</option>
									<option value="hours" selected>hours</option>
     							   	<option value="days">days</option>
  							{% else %}
     				  				<option value="minutes">minutes</option>
									<option value="hours">hours</option>
     							   	<option value="days">days</option>
  							{% endif %}
   							  </select></td>
		         </tr>
		         </table>
			    {% if display_tag_history_option == 1 %}
			      <p>&nbsp;</p>
				<h3>Tag History Option</h3>
			    <table>
			    <tr><td>
				    {% if config['tag_history'] == True %} 
				    		<input type="checkbox" class="form-control move-left" name="tag_history" value="selected" checked>
				    {% else %}
				         	<input type="checkbox" class="form-control move-left" name="tag_history" value="selected">
				    {% endif %}
				    Save tag values to BigQuery history table&nbsp;&nbsp;
			    </td></tr>
			    </table>
			    {% endif %}
			    {% if display_tag_stream_option == 1 %}
			      <p>&nbsp;</p>
				<h3>Tag Stream Option</h3>
			    <table>
			    <tr><td>
				    {% if config['tag_stream'] == True %} 
				    		<input type="checkbox" class="form-control move-left" name="tag_stream" value="selected" checked>
				    {% else %}
				         	<input type="checkbox" class="form-control move-left" name="tag_stream" value="selected">
				    {% endif %}
				    Save tag values to Pub/Sub tag stream topic&nbsp;&nbsp;
			    </td></tr>
			    </table>
			    {% endif %}
	         <p>&nbsp;</p>
		        <table>
		        <tr>
			   <td><input type="submit" value="Save Changes" name="action">&nbsp;<input type="submit" value="Cancel Changes" name="action"></td>
			   </table>
			   <input type="hidden" name="template_id" value="{{ template_id }}">
			   <input type="hidden" name="template_project" value="{{ template_project }}">
			   <input type="hidden" name="template_region" value="{{ template_region }}">
			   <input type="hidden" name="service_account" value="{{ service_account }}">
			   <input type="hidden" name="config_uuid" value="{{ config['config_uuid'] }}">
			   
			   {% for field in fields %}
			   	<input type="hidden" name="{{ field['field_id'] }}_datatype" value="{{ field['field_type'] }}">
			   {% endfor %}

         </form>
    </body>
</html>
