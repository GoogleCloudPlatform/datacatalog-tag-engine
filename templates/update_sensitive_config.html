<!DOCTYPE html>
<meta charset="utf-8">
  <head>
    <title>Tag Engine</title>
    <link rel="stylesheet" type="text/css" href="/static/style.css">
  </head>  
    <body>
	   <div class="pagetitle">
	   <h1>Tag Engine</h1>
        </div>
	   <div class="header">
	   <h2>Update sensitive config using {{ template_id }}</h2>
 	   <span style="color:#9d9a9a;">
 		   <h5>Make changes to your sensitive config below. The fields <i>sensitive_field</i> and <i>sensitive_type</i> must be in the tag, so they are not editable. The remaining fields can be updated. </h5>
 	  </span>
	   </div>
	  
	   <h3>Tag Template Fields</h3>
 	   <span style="color:#9d9a9a;">
 		   <h5>
	   
	 	Mandatory tag template fields are marked by <span style="color:red;">*</span>. 
	 	</h5>
	   </span>
	   
         <form method="post" action="/process_update_sensitive_config">
		    <table>
			   {% for field in fields %}
		        <tr>
				<td>
				{% if field['is_required'] == True %}
				<span style="color:red;">*</span>
				{% else: %}
				&nbsp;
				{% endif %}
				{{ field['field_id'] }} (type {{ field['field_type'] }})
				</td>
			   </tr>
			   {% endfor %}
			   </table>
		    <p>&nbsp;</p>
			

	   <h3>Enter DLP Findings Dataset</h3>
   
	   <span style="color:#9d9a9a;"><h5>
	   Specify the path to your DLP findings dataset in BigQuery. This is the location of the dataset that contains the inspection findings generated by DLP. <br><br>
			  Supported URI format: <br>
			    bigquery/project/[PROJECT]/dataset/[DATASET] <br>
		        </h5>
		</span>
		    <table>
		     <tr>
		    <td><span style="color:red;">*</span> DLP Dataset URI:&nbsp;&nbsp;
		    	  <input type="text" value="{{ config['dlp_dataset'] }}" name="dlp_dataset" style="align-content:left; width: 700px; overflow:auto;"/>

		    	</td>
		     </tr>
		 </table>
			 <p>&nbsp;</p>
	   
	   <h3>Enter Sensitive Category Table</h3>
 	   
	   <span style="color:#9d9a9a;"><h5>
	   Specify the path to your sensitive category mapping table in BigQuery. The schema for this table must include these three elements: (infotype STRING, category STRING, rank INTEGER). The infotype represents the value from DLP (e.g. PERSON_NAME, etc.), the category represents the broader sensitive category to map to (e.g. Sensitive Personal Data, etc.) and the rank represents the relative order of the categories in terms of their sensitivity. <br><br>
			  Supported URI format: <br>
			    bigquery/project/[PROJECT]/dataset/[DATASET]/[TABLE] <br>
		        </h5>
		</span>
		    <table>
		     <tr>
		    <td><span style="color:red;">*</span> Category Table URI:&nbsp;&nbsp;
		    	  <input type="text" value="{{ config['mapping_table'] }}" name="mapping_table" style="align-content:left; width: 700px; overflow:auto;"/>

		    	</td>
		     </tr>
		 </table>
			 <p>&nbsp;</p>
		   <h3>Enter Included and Excluded URIs</h3>
	 	   
		   <span style="color:#9d9a9a;"><h5>
		   Specify the URIs to the data assets you want to tag with this config. URIs must be GCS or BQ paths and separated by comma. Wildcards are allowed in the path name (GCS) and table name (BQ). <br><br>
				  Supported URIs for GCS files: <br>
				    gs://my-bucket/my-folder/* <br>
			        gs://my-bucket/my-folder/*.parquet <br>
				    gs://my-bucket/my-folderA/my-folderB/* <br><br>
			        
				  Supported URIs for BQ objects (datasets, tables, views): <br>
				    bigquery/project/{project_id}/* <br>
				    bigquery/project/{project_id}/dataset/{dataset}/* <br>
			        bigquery/project/{project_id}/dataset/{dataset}/{table} <br>
			        bigquery/project/{project_id}/dataset/{dataset}/{table}/{column} <br>		
					</h5>
			</span>
			    <table>
			     <tr>
			    <td><span style="color:red;">*</span> Included URIs:&nbsp;&nbsp;
			    	  <input type="text" name="included_uris" value="{{ config['included_uris'] }}" style="align-content:left; width: 700px; overflow:auto;"/>

			    	</td>
			     </tr>
			     <tr><td>&nbsp;</td></tr>
 				<tr>
 			    <td>&nbsp;&nbsp;Excluded URIs:&nbsp;
			    	  <input type="text" name="excluded_uris" value="{{ config['excluded_uris'] }}" style="align-content:left; width: 700px; overflow:auto;"/>			 
			    </td>
 		         </tr>
		    </table>
			<p>&nbsp;</p>
			
			
			<h3>Enter Policy Tag Details</h3>
 	   
					   <span style="color:#9d9a9a;"><h5>
					   Tag Engine can apply a policy tag on each sensitive column. This option requires a policy tag taxonomy with a policy tag name that matches each sensitive category. <br><br>
					   
					  The supported format for the Policy Tag Taxonomy ID: <br>
					    projects/[PROJECT]/locations/[REGION]/taxonomies/[TAXONOMY_ID] <br><br>
					   
					   	If you don't want Tag Engine to create any policies tags, set the Create Policy Tags flag to FALSE. <br><br>
							  
						        </h5>
						</span>
						    <table>
								   <tr><td><span style="color:red;">*</span>&nbsp;Create Policy Tags:</td>
									   <td>&nbsp;<select name="policy_tags" style="width: 80px;">
										   {% if config['create_policy_tags'] == True %} 
											   	<option value="true" selected>TRUE</option>
												<option value="false">FALSE</option>
										   {% elif config['create_policy_tags'] == False %}
										   	    <option value="true">TRUE</option>
												<option value="false" selected>FALSE</option>
										   {% endif %}
										</select></td> 
							    </tr>
						     </table>
							<br>
							<table>
							 <tr>
							
						    <td>&nbsp;&nbsp;Policy Tag Taxonomy ID:&nbsp;&nbsp;
						    	  <input type="text" value="{{ config['taxonomy_id'] }}" name="taxonomy_id" style="align-content:left; width: 700px; overflow:auto;"/>

						    	</td>
						     </tr>
						 </table>
							 
			
 		   
	        <p>&nbsp;</p>
			
 		   
		   
		   			   <h3>Choose Update Options</h3>
		 	   <span style="color:#9d9a9a;">
		 		   <h5>If you choose the AUTO refresh mode, your entry config will be scheduled for updates based on your specified refresh frequency.<br>
					   If you choose the ON-DEMAND refresh mode, your entry config will <b>not</b> be scheduled for updates (even if you specify a refresh frequency). <br>This mode is useful when no new files get added to your dataset on a regular basis or when you want to control the cataloging of new files through the Tag Engine API. <br><br>
				   </h5>
				</span>
			     <table>
 				<tr>	
 			    <td>Refresh mode:&nbsp;<select name="refresh_mode">
				    			{% if config['refresh_mode'] == 'AUTO' %}
   				  				<option value="AUTO" selected>AUTO</option>
   							   	<option value="ON-DEMAND">ON-DEMAND</option>
							{% else %}
   				  				<option value="AUTO">AUTO</option>
   							   	<option value="ON-DEMAND" selected>ON-DEMAND</option>
							{% endif %}
 							  </select>
							  
 			    </td>
 		         </tr>
 			     <tr><td>&nbsp;</td></tr>
				<tr>	
			    <td>Refresh frequency: <input type="text" value="{{ config['refresh_frequency'] }}" name="refresh_frequency" style="width: 30px;padding: 3px;"> &nbsp;<select name="refresh_unit" style="width: 70px;padding: 3px;">
	  						{% if config['refresh_unit'] == 'minutes' %}
	     				  			<option value="minutes" selected>minutes</option>
									<option value="hours">hours</option>
	     							<option value="days">days</option>
  				    		{% elif config['refresh_unit'] == 'hours' %}
     				  				<option value="minutes">minutes</option>
									<option value="hours" selected>hours</option>
     							   	<option value="days">days</option>
  							{% else %}
     				  				<option value="minutes">minutes</option>
									<option value="hours">hours</option>
     							   	<option value="days">days</option>
  							{% endif %}
   							  </select></td>
		         </tr>
		         </table>
			    {% if display_tag_history_option == 1 %}
			      <p>&nbsp;</p>
				<h3>Choose Tag History Option</h3>
			    <table>
			    <tr><td>
				    {% if config['tag_history'] == True %} 
				    		<input type="checkbox" class="form-control move-left" name="tag_history" value="selected" checked>
				    {% else %}
				         	<input type="checkbox" class="form-control move-left" name="tag_history" value="selected">
				    {% endif %}
				    Save tag values to BigQuery history table&nbsp;&nbsp;
			    </td></tr>
			    </table>
			    {% endif %}
			    {% if display_tag_stream_option == 1 %}
			      <p>&nbsp;</p>
				<h3>Choose Tag Stream Option</h3>
			    <table>
			    <tr><td>
				    {% if config['tag_stream'] == True %} 
				    		<input type="checkbox" class="form-control move-left" name="tag_stream" value="selected" checked>
				    {% else %}
				         	<input type="checkbox" class="form-control move-left" name="tag_stream" value="selected">
				    {% endif %}
				    Save tag values to Pub/Sub tag stream topic&nbsp;&nbsp;
			    </td></tr>
			    </table>
			    {% endif %}
	         <p>&nbsp;</p>
		        <table>
		        <tr>
			   <td><input type="submit" value="Submit Changes" name="action">&nbsp;<input type="submit" value="Cancel Changes" name="action"></td>
			   </table>
			   <input type="hidden" name="template_id" value="{{ template_id }}">
			   <input type="hidden" name="project_id" value="{{ project_id }}">
			   <input type="hidden" name="region" value="{{ region }}">
			   <input type="hidden" name="config_uuid" value="{{ config['config_uuid'] }}">
			   
			   {% for field in fields %}
			   	<input type="hidden" name="{{ field['field_id'] }}_datatype" value="{{ field['field_type'] }}">
			   {% endfor %}

         </form>
    </body>
</html>
